#!/usr/bin/env sh
# vi: ft=sh
#
# TODO: make more compositor-agnostic

workspaces() {
    active_workspace=$(hyprctl activewindow -j | jq '.workspace.id')
    command="hyprctl dispatch workspace"
    raw_box="(box\
        :class \"works\"\
        :orientation \"v\"\
        :halign \"center\"\
        :valign \"start\"\
        :space-evenly \"false\"\
        :spacing \"10\""

    focused () {
        if [[ "$1" == "$active_workspace" ]]; then
            echo 1
        else
            echo 0
        fi
    }

    for wsid in $(hyprctl workspaces -j | jq '.[].id' | sort); do
        name=$(hyprctl workspaces -j | jq '[.[] | if .id == '$wsid' then .name else "" end] | join("")')
        foc=$(focused $wsid)
        occ=1
        urg=0

        raw_box="$raw_box""(button \
            :onclick \"$command $wsid\"\
            :class \"ws-$urg$occ$foc\"\
            $name)"
    done

    echo "$raw_box"")"
}

function handle {
    if [[ ${1:0:9} == "workspace" ]]; then
        workspaces
    elif [[ ${1:0:10} == "focusedmon" ]]; then
        workspaces
    fi
}

socat - UNIX-CONNECT:/tmp/hypr/$(echo $HYPRLAND_INSTANCE_SIGNATURE)/.socket2.sock | while read line; do handle $line; done
